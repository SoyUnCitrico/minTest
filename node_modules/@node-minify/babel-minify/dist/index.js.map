{"version":3,"sources":["../src/index.ts"],"sourcesContent":["/*!\n * node-minify\n * Copyright(c) 2011-2023 Rodolphe Stoclin\n * MIT Licensed\n */\n\n/**\n * Module dependencies.\n */\nimport { transform } from 'babel-core';\nimport minify from 'babel-preset-minify';\nimport { utils } from '@node-minify/utils';\nimport { MinifierOptions } from '@node-minify/types';\n\ntype BabelOptions = {\n  presets: string[];\n};\n\ntype OptionsBabel = {\n  babelrc?: string;\n};\n\ntype SettingsBabel = {\n  options: OptionsBabel;\n};\n\ntype MinifierOptionsBabel = {\n  settings: SettingsBabel;\n};\n\n/**\n * Run babel-minify.\n *\n * @param {Object} settings\n * @param {String} content\n * @param {Function} callback\n * @param {Number} index\n */\nconst minifyBabel = ({ settings, content, callback, index }: MinifierOptions & MinifierOptionsBabel) => {\n  let babelOptions: BabelOptions = {\n    presets: []\n  };\n\n  if (settings?.options?.babelrc) {\n    babelOptions = JSON.parse(utils.readFile(settings.options.babelrc));\n  }\n\n  if (settings?.options?.presets) {\n    const babelrcPresets = babelOptions.presets || [];\n    babelOptions.presets = babelrcPresets.concat(\n      Array.isArray(settings.options.presets) ? settings.options.presets : []\n    );\n  }\n\n  if (babelOptions.presets.indexOf('minify') === -1) {\n    babelOptions.presets = babelOptions.presets.concat([minify]);\n  }\n\n  const contentMinified = transform(content ?? '', babelOptions);\n  if (settings && !settings.content && settings.output) {\n    settings.output && utils.writeFile({ file: settings.output, content: contentMinified.code, index });\n  }\n  if (callback) {\n    return callback(null, contentMinified.code);\n  }\n  return contentMinified.code;\n};\n\n/**\n * Expose `minifyBabel()`.\n */\nminifyBabel.default = minifyBabel;\nexport = minifyBabel;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AASA,wBAA0B;AAC1B,iCAAmB;AACnB,mBAAsB;AA2BtB,IAAM,cAAc,CAAC,EAAE,UAAU,SAAS,UAAU,MAAM,MAA8C;AACtG,MAAI,eAA6B;AAAA,IAC/B,SAAS,CAAC;AAAA,EACZ;AAEA,MAAI,UAAU,SAAS,SAAS;AAC9B,mBAAe,KAAK,MAAM,mBAAM,SAAS,SAAS,QAAQ,OAAO,CAAC;AAAA,EACpE;AAEA,MAAI,UAAU,SAAS,SAAS;AAC9B,UAAM,iBAAiB,aAAa,WAAW,CAAC;AAChD,iBAAa,UAAU,eAAe;AAAA,MACpC,MAAM,QAAQ,SAAS,QAAQ,OAAO,IAAI,SAAS,QAAQ,UAAU,CAAC;AAAA,IACxE;AAAA,EACF;AAEA,MAAI,aAAa,QAAQ,QAAQ,QAAQ,MAAM,IAAI;AACjD,iBAAa,UAAU,aAAa,QAAQ,OAAO,CAAC,2BAAAA,OAAM,CAAC;AAAA,EAC7D;AAEA,QAAM,sBAAkB,6BAAU,WAAW,IAAI,YAAY;AAC7D,MAAI,YAAY,CAAC,SAAS,WAAW,SAAS,QAAQ;AACpD,aAAS,UAAU,mBAAM,UAAU,EAAE,MAAM,SAAS,QAAQ,SAAS,gBAAgB,MAAM,MAAM,CAAC;AAAA,EACpG;AACA,MAAI,UAAU;AACZ,WAAO,SAAS,MAAM,gBAAgB,IAAI;AAAA,EAC5C;AACA,SAAO,gBAAgB;AACzB;AAKA,YAAY,UAAU;AACtB,iBAAS;","names":["minify"]}