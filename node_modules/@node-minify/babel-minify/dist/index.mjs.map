{"version":3,"sources":["../src/index.ts"],"sourcesContent":["/*!\n * node-minify\n * Copyright(c) 2011-2023 Rodolphe Stoclin\n * MIT Licensed\n */\n\n/**\n * Module dependencies.\n */\nimport { transform } from 'babel-core';\nimport minify from 'babel-preset-minify';\nimport { utils } from '@node-minify/utils';\nimport { MinifierOptions } from '@node-minify/types';\n\ntype BabelOptions = {\n  presets: string[];\n};\n\ntype OptionsBabel = {\n  babelrc?: string;\n};\n\ntype SettingsBabel = {\n  options: OptionsBabel;\n};\n\ntype MinifierOptionsBabel = {\n  settings: SettingsBabel;\n};\n\n/**\n * Run babel-minify.\n *\n * @param {Object} settings\n * @param {String} content\n * @param {Function} callback\n * @param {Number} index\n */\nconst minifyBabel = ({ settings, content, callback, index }: MinifierOptions & MinifierOptionsBabel) => {\n  let babelOptions: BabelOptions = {\n    presets: []\n  };\n\n  if (settings?.options?.babelrc) {\n    babelOptions = JSON.parse(utils.readFile(settings.options.babelrc));\n  }\n\n  if (settings?.options?.presets) {\n    const babelrcPresets = babelOptions.presets || [];\n    babelOptions.presets = babelrcPresets.concat(\n      Array.isArray(settings.options.presets) ? settings.options.presets : []\n    );\n  }\n\n  if (babelOptions.presets.indexOf('minify') === -1) {\n    babelOptions.presets = babelOptions.presets.concat([minify]);\n  }\n\n  const contentMinified = transform(content ?? '', babelOptions);\n  if (settings && !settings.content && settings.output) {\n    settings.output && utils.writeFile({ file: settings.output, content: contentMinified.code, index });\n  }\n  if (callback) {\n    return callback(null, contentMinified.code);\n  }\n  return contentMinified.code;\n};\n\n/**\n * Expose `minifyBabel()`.\n */\nminifyBabel.default = minifyBabel;\nexport = minifyBabel;\n"],"mappings":";;;;;;AASA,SAAS,iBAAiB;AAC1B,OAAO,YAAY;AACnB,SAAS,aAAa;AAXtB;AAAA;AAsCA,QAAM,cAAc,CAAC,EAAE,UAAU,SAAS,UAAU,MAAM,MAA8C;AACtG,UAAI,eAA6B;AAAA,QAC/B,SAAS,CAAC;AAAA,MACZ;AAEA,UAAI,UAAU,SAAS,SAAS;AAC9B,uBAAe,KAAK,MAAM,MAAM,SAAS,SAAS,QAAQ,OAAO,CAAC;AAAA,MACpE;AAEA,UAAI,UAAU,SAAS,SAAS;AAC9B,cAAM,iBAAiB,aAAa,WAAW,CAAC;AAChD,qBAAa,UAAU,eAAe;AAAA,UACpC,MAAM,QAAQ,SAAS,QAAQ,OAAO,IAAI,SAAS,QAAQ,UAAU,CAAC;AAAA,QACxE;AAAA,MACF;AAEA,UAAI,aAAa,QAAQ,QAAQ,QAAQ,MAAM,IAAI;AACjD,qBAAa,UAAU,aAAa,QAAQ,OAAO,CAAC,MAAM,CAAC;AAAA,MAC7D;AAEA,YAAM,kBAAkB,UAAU,WAAW,IAAI,YAAY;AAC7D,UAAI,YAAY,CAAC,SAAS,WAAW,SAAS,QAAQ;AACpD,iBAAS,UAAU,MAAM,UAAU,EAAE,MAAM,SAAS,QAAQ,SAAS,gBAAgB,MAAM,MAAM,CAAC;AAAA,MACpG;AACA,UAAI,UAAU;AACZ,eAAO,SAAS,MAAM,gBAAgB,IAAI;AAAA,MAC5C;AACA,aAAO,gBAAgB;AAAA,IACzB;AAKA,gBAAY,UAAU;AACtB,qBAAS;AAAA;AAAA;","names":[]}